<project name="pmdtasktest" default="all">

	<property name="pmd.home" value="${user.dir}"/>

    <taskdef name="pmd" classname="net.sourceforge.pmd.ant.PMDTask"/>

	<target name="testNestedRuleset">
		<pmd>
			<ruleset>${pmd.home}/src/main/resources/category/java/codestyle.xml</ruleset>
			<ruleset>${pmd.home}/src/main/resources/category/java/design.xml</ruleset>
			<formatter type="text" toConsole="true"/>
			<fileset dir="${pmd.home}/src/test/resources/ant/java">
				<include name="*.java"/>
			</fileset>
		</pmd>
	</target>

	<target name="testFormatterWithProperties">
		<pmd>
			<ruleset>${pmd.home}/src/main/resources/category/java/codestyle.xml</ruleset>
			<ruleset>${pmd.home}/src/main/resources/category/java/design.xml</ruleset>
			<formatter type="summaryhtml" toConsole="true">
				<param name="linkPrefix" value="link_prefix"/>
				<param name="linePrefix" value="line_prefix"/>
			</formatter>
			<fileset dir="${pmd.home}/src/test/resources/ant/java">
				<include name="*.java"/>
			</fileset>
		</pmd>
	</target>

	<target name="testAbstractNames">
		<pmd rulesetfiles="category/java/codestyle.xml,category/java/design.xml">
			<formatter type="text" toConsole="true"/>
			<fileset dir="${pmd.home}/src/test/resources/ant/java">
				<include name="*.java"/>
			</fileset>
		</pmd>
	</target>

	<target name="testAbstractNamesInNestedRuleset">
		<pmd>
			<ruleset>category/java/codestyle.xml</ruleset>
			<ruleset>category/java/design.xml</ruleset>
			<formatter type="text" toConsole="true"/>
			<fileset dir="${pmd.home}/src/test/resources/ant/java">
				<include name="*.java"/>
			</fileset>
		</pmd>
	</target>

	<target name="testCommaInRulesetfiles">
		<pmd rulesetfiles="${pmd.home}/src/main/resources/category/java/codestyle.xml,${pmd.home}/src/main/resources/category/java/design.xml">
			<formatter type="text" toConsole="true"/>
			<fileset dir="${pmd.home}/src/test/resources/ant/java">
				<include name="*.java"/>
			</fileset>
		</pmd>
	</target>

	<target name="testRelativeRulesets">
		<pmd>
			<ruleset>custom_ruleset.xml</ruleset>
			<ruleset>category/java/codestyle.xml</ruleset>
			<formatter type="text" toConsole="true"/>
			<fileset dir="${pmd.home}/src/test/resources/ant/java">
				<include name="*.java"/>
			</fileset>
		</pmd>
	</target>

	<target name="testRelativeRulesetsInRulesetfiles">
		<pmd rulesetfiles="custom_ruleset.xml,src/main/resources/category/java/codestyle.xml">
			<formatter type="text" toConsole="true"/>
			<fileset dir="${pmd.home}/src/test/resources/ant/java">
				<include name="*.java"/>
			</fileset>
		</pmd>
	</target>

	<target name="testNoFormattersValidation">
		<pmd rulesetfiles="${pmd.home}/src/main/resources/category/java/codestyle.xml">
            <fileset dir="${pmd.home}/src/test/resources/ant/java">
                <include name="*.java"/>
            </fileset>
		</pmd>
	</target>

	<target name="testExplicitRuleInRuleSet">
		<pmd rulesetfiles="src/main/resources/category/java/design.xml/ExcessiveMethodLength">
			<formatter type="text" toConsole="true"/>
			<fileset dir="${pmd.home}/src/test/resources/ant/java">
				<include name="*.java"/>
			</fileset>
		</pmd>
	</target>

    <target name="testClasspath">
        <pmd>
            <ruleset>classpathtest/ruleset.xml</ruleset>
            <classpath>
                <pathelement path="${pmd.home}/target/classes"/>
                <pathelement path="${pmd.home}/target/test-classes"/>
                <pathelement path="${pmd.home}/target/test-classes/net/sourceforge/pmd/ant"/>
                <pathelement path="${pmd.home}/target/clover/test-classes"/>
                <pathelement path="${pmd.home}/target/clover/test-classes/net/sourceforge/pmd/ant"/>
            </classpath>
        </pmd>
    </target>

    <target name="testFormatterEncodingWithXML">
        <!-- source encoding is cp1252 -->
        <pmd encoding="cp1252">
            <ruleset>category/java/bestpractices.xml</ruleset>
            <!--
            <formatter type="xml" toConsole="true"/>
            -->
            <formatter type="xml" toFile="${tmpfile}">
                <param name="encoding" value="UTF-8" /> <!-- report encoding -->
            </formatter>
            <fileset dir="${pmd.home}/src/test/resources/ant/java">
                <include name="EncodingTestClass.java" />
                <include name="MoreThanThousandLinesOfCodeWithDuplicateLiterals.java" />
            </fileset>
        </pmd>
    </target>

    <target name="testFormatterEncodingWithXMLConsole">
        <!-- source encoding is cp1252 -->
        <pmd encoding="cp1252">
            <ruleset>category/java/bestpractices.xml</ruleset>
            <formatter type="xml" toConsole="true">
                <!-- specifying a encoding here will override the console encoding.
                     The output might have junk characters in it.

                     <param name="encoding" value="UTF-8" />

                     The test doesn't specify the report encoding, so that the console/default encoding is used
                 -->
            </formatter>
            <fileset dir="${pmd.home}/src/test/resources/ant/java">
                <include name="EncodingTestClass.java" />
            </fileset>
        </pmd>
    </target>

	<target name="testAnalysisCache">
		<pmd rulesetfiles="src/main/resources/category/java/design.xml/ExcessiveMethodLength" cacheLocation="${tmpfile}">
			<formatter type="xml" toConsole="true"/>
			<fileset dir="${pmd.home}/src/test/resources/ant/java">
				<include name="*.java"/>
			</fileset>
		</pmd>
	</target>

	<target name="testMissingCacheLocation">
		<pmd rulesetfiles="src/main/resources/category/java/design.xml/ExcessiveMethodLength">
			<formatter type="xml" toConsole="true"/>
			<fileset dir="${pmd.home}/src/test/resources/ant/java">
				<include name="*.java"/>
			</fileset>
		</pmd>
	</target>

	<target name="testDisableIncrementalAnalysis">
		<pmd rulesetfiles="src/main/resources/category/java/design.xml/ExcessiveMethodLength" noCache="true" cacheLocation="${tmpfile}">
			<formatter type="xml" toConsole="true"/>
			<fileset dir="${pmd.home}/src/test/resources/ant/java">
				<include name="*.java"/>
			</fileset>
		</pmd>
	</target>
</project>
