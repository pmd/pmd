<?xml version="1.0" encoding="UTF-8"?>
<test-data
        xmlns="http://pmd.sourceforge.net/rule-tests"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://pmd.sourceforge.net/rule-tests http://pmd.sourceforge.net/rule-tests_1_0_0.xsd">
    <test-code>
        <description>Comparable without equals and hashCode</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>3</expected-linenumbers>
        <expected-messages>
            <message>When implementing Comparable, both equals() and hashCode() should be overridden</message>
        </expected-messages>
        <code><![CDATA[
            class Foo implements Comparable<Foo> {
                @Override
                public int compareTo(Foo o) {
                    return 0;
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Comparable with equals but no hashCode</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>8</expected-linenumbers>
        <expected-messages>
            <message>When implementing Comparable, hashCode() should be overridden</message>
        </expected-messages>
        <code><![CDATA[
            class Foo implements Comparable<Foo> {
                @Override
                public int compareTo(Foo o) {
                    return 0;
                }

                @Override
                public boolean equals(Object o) {
                    return o instanceof Foo && compareTo((Foo) o) == 0;
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Comparable with hashCode but no equals</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>8</expected-linenumbers>
        <expected-messages>
            <message>When implementing Comparable, equals() should be overridden</message>
        </expected-messages>
        <code><![CDATA[
            class Foo implements Comparable<Foo> {
                @Override
                public int compareTo(Foo o) {
                    return 0;
                }

                @Override
                public int hashCode() {
                    return 0;
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Comparable with both methods</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
            class Foo implements Comparable<Foo> {
                @Override
                public int compareTo(Foo o) {
                    return 0;
                }

                @Override
                public boolean equals(Object o) {
                    return o instanceof Foo && compareTo((Foo) o) == 0;
                }

                @Override
                public int hashCode() {
                    return 0;
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Ignore classes that don't implement Comparable</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
            class Foo {
                public int compareTo(Foo o) {
                    return 0;
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Non-Comparable class</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
            class Foo {
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Comparable interface</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
            interface Foo extends Comparable<Foo> {
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Comparable with wrong equals signature</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>3</expected-linenumbers>
        <expected-messages>
           <message>When implementing Comparable, both equals() and hashCode() should be overridden</message>
        </expected-messages>
        <code><![CDATA[
            class Foo implements Comparable<Foo> {
                @Override
                public int compareTo(Foo o) {
                    return 0;
                }

                public boolean equals(Foo o) {
                    return compareTo(o) == 0;
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Raw Comparable</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>3</expected-linenumbers>
        <expected-messages>
            <message>When implementing Comparable, both equals() and hashCode() should be overridden</message>
        </expected-messages>
        <code><![CDATA[
            class Foo implements Comparable {
                @Override
                public int compareTo(Object o) {
                    return 0;
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Anonymous Comparable</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>4</expected-linenumbers>
        <expected-messages>
            <message>When implementing Comparable, both equals() and hashCode() should be overridden</message>
        </expected-messages>
        <code><![CDATA[
            class Test {
                Comparable<Object> anonymous = new Comparable<Object>() {
                    @Override
                    public int compareTo(Object o) {
                        return 0;
                    }
                };
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>FileId interface with proper methods</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
            public interface FileId extends Comparable<FileId> {
                @Override
                boolean equals(Object o);

                @Override
                int hashCode();

                @Override
                default int compareTo(FileId o) {
                    return 0;
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Abstract class</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
            public abstract class AbstractTestClass {
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Abstract class with equals</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
            public abstract class AbstractWithOneMethod {
                @Override
                public boolean equals(Object o) {
                    return false;
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Non-Comparable class with equals but no hashCode</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
        class Foo {
            @Override
            public boolean equals(Object o) {
                return false;
            }
        }
        ]]></code>
    </test-code>
    <test-code>
        <description>enum declaration with no methods</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
            public enum SimpleEnum {
                VALUE1, VALUE2
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>enum declaration with implementation but no methods (anonymous classes)</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
            public enum SimpleEnum {
                VALUE1 { }, VALUE2 { }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Record with Comparable and no explicit equals/hashCode</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
            public record Foo(int x, int y) implements Comparable<Foo> {
                @Override
                public int compareTo(Foo o) {
                    return Integer.compare(this.x, o.x);
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Record with Comparable and explicit equals</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>8</expected-linenumbers>
        <expected-messages>
            <message>When implementing Comparable, hashCode() should be overridden</message>
        </expected-messages>
        <code><![CDATA[
            public record Foo(int x, int y) implements Comparable<Foo> {
                @Override
                public int compareTo(Foo o) {
                    return Integer.compare(this.x, o.x);
                }

                @Override
                public boolean equals(Object o) {
                    return o instanceof Foo f && compareTo(f) == 0;
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Record with Comparable and explicit hashCode</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>8</expected-linenumbers>
        <expected-messages>
            <message>When implementing Comparable, equals() should be overridden</message>
        </expected-messages>
        <code><![CDATA[
            public record Foo(int x, int y) implements Comparable<Foo> {
                @Override
                public int compareTo(Foo o) {
                    return Integer.compare(this.x, o.x);
                }

                @Override
                public int hashCode() {
                    return x;
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Record with Comparable and both explicit equals and hashCode</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
            public record Foo(int x, int y) implements Comparable<Foo> {
                @Override
                public int compareTo(Foo o) {
                    return Integer.compare(this.x, o.x);
                }

                @Override
                public boolean equals(Object o) {
                    return o instanceof Foo f && compareTo(f) == 0;
                }

                @Override
                public int hashCode() {
                    return x;
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Record without Comparable</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
            public record Foo(int x, int y) {
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Comparable Record with wrong equals signature</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>3</expected-linenumbers>
        <expected-messages>
            <message>When implementing Comparable, both equals() and hashCode() should be overridden</message>
        </expected-messages>
        <code><![CDATA[
            public record Foo(int x, int y) implements Comparable<Foo> {
                @Override
                public int compareTo(Foo o) {
                    return Integer.compare(this.x, o.x);
                }

                public boolean equals(Foo o) {
                    return compareTo(o) == 0;
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Do report in inherited Comparables with compareTo</description>
        <expected-problems>1</expected-problems>
        <expected-linenumbers>4</expected-linenumbers>
        <code><![CDATA[
            import java.io.File;
            public class MyFile extends File {
                @Override
                public int compareTo(File other) {
                    return 0;
                }
            }
        ]]></code>
    </test-code>
    <test-code>
        <description>Do not report in inherited Comparables without compareTo</description>
        <expected-problems>0</expected-problems>
        <code><![CDATA[
            import java.io.File;
            public class MyFile extends File {
            }
        ]]></code>
    </test-code>
</test-data>
